<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <h1 class="mb-4"> Dashboard</h1>
    <a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">â¬… Back</a>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="alert alert-warning">
            {% for m in messages %}
                <div>{{ m }}</div>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <h4>Dataset Preview</h4>
    <div class="table-responsive mb-4">
        {{ preview_html|safe }}
    </div>

    <form method="get" action="{{ url_for('dashboard') }}" class="row g-3 mb-4">
        {% if filename %}
            <input type="hidden" name="filename" value="{{ filename }}">
        {% elif sample %}
            <input type="hidden" name="sample" value="{{ sample }}">
        {% endif %}

        <div class="col-md-4">
            <label for="x_col" class="form-label">X-Axis</label>
            <select name="x_col" class="form-select">
                <option value="">-- Select --</option>
                {% for c in columns %}
                    <option value="{{ c }}" {% if selected_x == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-4">
            <label for="y_col" class="form-label">Y-Axis</label>
            <select name="y_col" class="form-select">
                <option value="">-- Select --</option>
                {% for c in numeric_columns %}
                    <option value="{{ c }}" {% if selected_y == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-4">
            <label for="chart_type" class="form-label">Chart Type</label>
            <select name="chart_type" class="form-select">
                <option value="line" {% if chart_type == "line" %}selected{% endif %}>Line</option>
                <option value="bar" {% if chart_type == "bar" %}selected{% endif %}>Bar</option>
                <option value="scatter" {% if chart_type == "scatter" %}selected{% endif %}>Scatter</option>
            </select>
        </div>

        <div class="col-12">
            <button class="btn btn-success" type="submit">Generate Chart</button>
            <a href="{{ url_for('download', filename=filename, sample=sample) }}" class="btn btn-outline-primary">Download CSV</a>
        </div>
    </form>

    {% if chart_div %}
        <div class="card p-3 shadow-sm">
            {{ chart_div|safe }}
        </div>
    {% endif %}
</div>

</body>
</html>
